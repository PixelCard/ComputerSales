@model ComputerSalesProject_MVC.Areas.Admin.Models.Product_Overview.ProductOverviewEditVM

@{
    ViewData["Title"] = "Chỉnh sửa Product Overview";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="max-w-4xl mx-auto py-8">
    <!-- Header -->
    <div class="bg-white shadow rounded-xl p-6 mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Chỉnh sửa Product Overview</h1>
                <p class="text-gray-600 mt-1">ID: @Model.ProductOverviewId</p>
            </div>
            <a asp-area="Admin"
               asp-controller="Product"
               asp-action="ProductDetails"
               asp-route-id="@Model.ProductId"
               class="inline-flex items-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i> Quay lại
            </a>
        </div>
    </div>

    <!-- Form -->
    <div class="bg-white shadow rounded-xl p-6">
        <form asp-action="Edit" method="post" class="space-y-6">
            @Html.AntiForgeryToken()
            
            <!-- Hidden fields -->
            <input asp-for="ProductOverviewId" type="hidden" />
            <input asp-for="ProductId" type="hidden" />

            <!-- Product ID Display -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                    <div>
                        <p class="text-sm font-medium text-blue-800">Product ID</p>
                        <p class="text-sm text-blue-600">@Model.ProductId</p>
                    </div>
                </div>
            </div>

            <!-- Text Content -->
            <div>
                <label asp-for="TextContent" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-file-alt mr-2"></i>Nội dung Overview
                </label>
                <textarea asp-for="TextContent" 
                          rows="10"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                          placeholder="Nhập nội dung mô tả chi tiết sản phẩm..."></textarea>
                <span asp-validation-for="TextContent" class="text-red-500 text-sm"></span>
            </div>

            <!-- Preview Section -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-eye mr-2"></i>Xem trước
                </label>
                <div id="preview" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 min-h-32">
                    <p class="text-gray-500 italic">Nội dung sẽ hiển thị ở đây...</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
                <a asp-area="Admin"
                   asp-controller="Product"
                   asp-action="ProductDetails"
                   asp-route-id="@Model.ProductId"
                   class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    Hủy
                </a>
                <button type="submit" 
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-save mr-2"></i>Cập nhật
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.tiny.cloud/1/@ViewBag.TinyMCEApiKey/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        tinymce.init({
          selector: '#TextContent',
          height: 420,
          menubar: 'edit view insert format tools table help',
          plugins: 'lists link image table code paste',
          toolbar: 'undo redo | blocks | bold italic underline | ' +
                   'alignleft aligncenter alignright alignjustify | bullist numlist | ' +
                   'link image table | outdent indent | code',
          block_formats: 'Paragraph=p; Heading 1=h1; Heading 2=h2; Heading 3=h3',
          branding: false,
          setup: function (editor) {
            editor.on('change', function () {
              editor.save(); // Sync với textarea
            });
          }
        });

        // Form submission loading state
        document.querySelector('form').addEventListener('submit', function() {
            tinymce.triggerSave(); // Đảm bảo content được sync
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Đang cập nhật...';
            submitBtn.disabled = true;
        });
    </script>
}
