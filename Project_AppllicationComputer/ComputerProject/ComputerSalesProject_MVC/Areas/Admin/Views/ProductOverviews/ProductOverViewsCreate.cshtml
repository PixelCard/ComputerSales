@model ComputerSalesProject_MVC.Areas.Admin.Models.Product_Overview.ProductOverviewCreateVM
@{
    ViewData["Title"] = "Create Overview Block";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";

    var productSKU = ViewBag.ProductSKU as string;
}

<div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <!-- Header -->
    <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Create Overview Block</h1>
                <p class="text-sm text-gray-600 mt-1">
                    Add a new overview block for product: <span class="font-medium text-blue-600">@productSKU</span>
                </p>
            </div>
            <div class="flex items-center gap-3">
                <a asp-action="ProductOverViewsIndex" asp-route-productId="@Model.ProductId" 
                   class="inline-flex items-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to List
                </a>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="p-6">
        <form asp-action="ProductOverViewsCreate" method="post" class="space-y-6">
            @Html.AntiForgeryToken()
            <input asp-for="ProductId" type="hidden" />

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Form -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Block Type Selection -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Block Type</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <label class="relative cursor-pointer">
                                <input asp-for="BlockType" type="radio" value="Text" class="sr-only peer" />
                                <div class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                                    <div class="flex items-center">
                                        <i class="fas fa-text-width text-2xl text-gray-400 peer-checked:text-blue-600 mr-3"></i>
                                        <div>
                                            <div class="font-medium text-gray-900">Text</div>
                                            <div class="text-sm text-gray-500">Plain text content</div>
                                        </div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer">
                                <input asp-for="BlockType" type="radio" value="List" class="sr-only peer" />
                                <div class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                                    <div class="flex items-center">
                                        <i class="fas fa-list text-2xl text-gray-400 peer-checked:text-blue-600 mr-3"></i>
                                        <div>
                                            <div class="font-medium text-gray-900">List</div>
                                            <div class="text-sm text-gray-500">Bulleted list</div>
                                        </div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer">
                                <input asp-for="BlockType" type="radio" value="Image" class="sr-only peer" />
                                <div class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                                    <div class="flex items-center">
                                        <i class="fas fa-image text-2xl text-gray-400 peer-checked:text-blue-600 mr-3"></i>
                                        <div>
                                            <div class="font-medium text-gray-900">Image</div>
                                            <div class="text-sm text-gray-500">Image with caption</div>
                                        </div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer">
                                <input asp-for="BlockType" type="radio" value="Logo" class="sr-only peer" />
                                <div class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                                    <div class="flex items-center">
                                        <i class="fas fa-trademark text-2xl text-gray-400 peer-checked:text-blue-600 mr-3"></i>
                                        <div>
                                            <div class="font-medium text-gray-900">Logo</div>
                                            <div class="text-sm text-gray-500">Company logo</div>
                                        </div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer">
                                <input asp-for="BlockType" type="radio" value="Table" class="sr-only peer" />
                                <div class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                                    <div class="flex items-center">
                                        <i class="fas fa-table text-2xl text-gray-400 peer-checked:text-blue-600 mr-3"></i>
                                        <div>
                                            <div class="font-medium text-gray-900">Table</div>
                                            <div class="text-sm text-gray-500">Data table</div>
                                        </div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <span asp-validation-for="BlockType" class="text-red-500 text-sm"></span>
                    </div>

                    <!-- Content Fields -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Content</h3>
                        
                        <!-- Text Content (for Text and List) -->
                        <div id="text-content-section" class="space-y-4" style="display: none;">
                            <div>
                                <label asp-for="TextContent" class="block text-sm font-medium text-gray-700 mb-2">
                                    Text Content
                                </label>
                                <textarea asp-for="TextContent" rows="6" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Enter your text content here..."></textarea>
                                <span asp-validation-for="TextContent" class="text-red-500 text-sm"></span>
                                <p class="text-sm text-gray-500 mt-1">
                                    For lists, separate each item with a new line.
                                </p>
                            </div>
                        </div>

                        <!-- Image Content (for Image and Logo) -->
                        <div id="image-content-section" class="space-y-4" style="display: none;">
                            <div>
                                <label asp-for="ImageUrl" class="block text-sm font-medium text-gray-700 mb-2">
                                    Image URL
                                </label>
                                <input asp-for="ImageUrl" type="url" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="https://example.com/image.jpg" />
                                <span asp-validation-for="ImageUrl" class="text-red-500 text-sm"></span>
                            </div>
                            
                            <div>
                                <label asp-for="Caption" class="block text-sm font-medium text-gray-700 mb-2">
                                    Caption (Optional)
                                </label>
                                <input asp-for="Caption" type="text" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Enter image caption..." />
                                <span asp-validation-for="Caption" class="text-red-500 text-sm"></span>
                            </div>
                        </div>

                        <!-- Table Content -->
                        <div id="table-content-section" class="space-y-4" style="display: none;">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex">
                                    <i class="fas fa-info-circle text-yellow-600 mr-2 mt-0.5"></i>
                                    <div>
                                        <h4 class="text-sm font-medium text-yellow-800">Table Content</h4>
                                        <p class="text-sm text-yellow-700 mt-1">
                                            Table content will be handled separately. This block type is reserved for future table functionality.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Display Order -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Display Settings</h3>
                        <div>
                            <label asp-for="DisplayOrder" class="block text-sm font-medium text-gray-700 mb-2">
                                Display Order
                            </label>
                            <input asp-for="DisplayOrder" type="number" min="1" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <span asp-validation-for="DisplayOrder" class="text-red-500 text-sm"></span>
                            <p class="text-sm text-gray-500 mt-1">
                                Lower numbers appear first. This has been auto-suggested based on existing blocks.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Preview -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Preview</h3>
                        <div id="preview-content" class="min-h-32 bg-gray-50 rounded-lg p-4 border-2 border-dashed border-gray-300">
                            <p class="text-gray-500 text-center">Select a block type to see preview</p>
                        </div>
                    </div>

                    <!-- Help -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-blue-900 mb-4">Help</h3>
                        <div class="space-y-3 text-sm text-blue-800">
                            <div>
                                <strong>Text:</strong> Use for paragraphs and general text content.
                            </div>
                            <div>
                                <strong>List:</strong> Use for bulleted lists. Each line becomes a list item.
                            </div>
                            <div>
                                <strong>Image:</strong> Use for photos, diagrams, or illustrations.
                            </div>
                            <div>
                                <strong>Logo:</strong> Use for company logos or brand elements.
                            </div>
                            <div>
                                <strong>Table:</strong> Reserved for future table functionality.
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3>
                        <div class="space-y-3">
                            <button type="submit" 
                                class="w-full inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                Create Overview Block
                            </button>
                            <a asp-action="ProductOverViewsIndex" asp-route-productId="@Model.ProductId" 
                               class="w-full inline-flex items-center justify-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors">
                                <i class="fas fa-times mr-2"></i>
                                Cancel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const blockTypeInputs = document.querySelectorAll('input[name="BlockType"]');
            const textContentSection = document.getElementById('text-content-section');
            const imageContentSection = document.getElementById('image-content-section');
            const tableContentSection = document.getElementById('table-content-section');
            const previewContent = document.getElementById('preview-content');

            function updateContentSections() {
                const selectedType = document.querySelector('input[name="BlockType"]:checked')?.value;
                
                // Hide all sections
                textContentSection.style.display = 'none';
                imageContentSection.style.display = 'none';
                tableContentSection.style.display = 'none';
                
                // Show relevant section
                if (selectedType === 'Text' || selectedType === 'List') {
                    textContentSection.style.display = 'block';
                } else if (selectedType === 'Image' || selectedType === 'Logo') {
                    imageContentSection.style.display = 'block';
                } else if (selectedType === 'Table') {
                    tableContentSection.style.display = 'block';
                }
                
                updatePreview();
            }

            function updatePreview() {
                const selectedType = document.querySelector('input[name="BlockType"]:checked')?.value;
                const textContent = document.querySelector('textarea[name="TextContent"]')?.value || '';
                const imageUrl = document.querySelector('input[name="ImageUrl"]')?.value || '';
                const caption = document.querySelector('input[name="Caption"]')?.value || '';

                let previewHtml = '';

                if (selectedType === 'Text') {
                    previewHtml = textContent ? `<p class="whitespace-pre-wrap">${textContent}</p>` : '<p class="text-gray-500 italic">No text content</p>';
                } else if (selectedType === 'List') {
                    if (textContent) {
                        const items = textContent.split('\n').filter(item => item.trim());
                        previewHtml = '<ul class="list-disc list-inside space-y-1">';
                        items.forEach(item => {
                            previewHtml += `<li>${item.trim()}</li>`;
                        });
                        previewHtml += '</ul>';
                    } else {
                        previewHtml = '<p class="text-gray-500 italic">No list items</p>';
                    }
                } else if (selectedType === 'Image' || selectedType === 'Logo') {
                    if (imageUrl) {
                        previewHtml = `<div class="space-y-2">
                            <img src="${imageUrl}" alt="${caption}" class="max-w-full h-auto rounded-lg border">
                            ${caption ? `<p class="text-sm text-gray-600 text-center">${caption}</p>` : ''}
                        </div>`;
                    } else {
                        previewHtml = '<div class="text-center text-gray-500 italic">No image URL provided</div>';
                    }
                } else if (selectedType === 'Table') {
                    previewHtml = '<div class="text-center text-gray-500 italic">Table preview not available</div>';
                } else {
                    previewHtml = '<p class="text-gray-500 text-center">Select a block type to see preview</p>';
                }

                previewContent.innerHTML = previewHtml;
            }

            // Add event listeners
            blockTypeInputs.forEach(input => {
                input.addEventListener('change', updateContentSections);
            });

            // Add event listeners for content changes
            document.querySelector('textarea[name="TextContent"]')?.addEventListener('input', updatePreview);
            document.querySelector('input[name="ImageUrl"]')?.addEventListener('input', updatePreview);
            document.querySelector('input[name="Caption"]')?.addEventListener('input', updatePreview);

            // Initialize
            updateContentSections();
        });
    </script>
}
