@model ComputerSales.Application.UseCaseDTO.Order_DTO.OrderOutputDTO
<script src="https://cdn.tailwindcss.com"></script>
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
    Layout = null;

    // Chọn màu nhấn theo trạng thái đơn hàng để dùng cho viền/trang trí
    var accentFrom = "from-amber-400";   // default ChoXacNhan
    var accentTo = "to-amber-600";
    var borderAccent = "border-amber-400";
    switch (Model.OrderStatus)
    {
        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DangDongGoi:
            accentFrom = "from-sky-400"; accentTo = "to-sky-600"; borderAccent = "border-sky-400"; break;
        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DangGiao:
            accentFrom = "from-blue-500"; accentTo = "to-blue-700"; borderAccent = "border-blue-500"; break;
        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DaGiaoThanhCong:
            accentFrom = "from-emerald-500"; accentTo = "to-emerald-700"; borderAccent = "border-emerald-500"; break;
        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DaHuy:
            accentFrom = "from-rose-500"; accentTo = "to-rose-700"; borderAccent = "border-rose-500"; break;
    }
}

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 py-12 px-4 flex items-start justify-center relative">
    <div class="pointer-events-none absolute inset-0 [background:radial-gradient(500px_200px_at_20%_0%,rgba(99,102,241,0.08),transparent_60%),radial-gradient(600px_240px_at_100%_10%,rgba(20,184,166,0.08),transparent_60%)]"></div>

    <div class="relative w-full max-w-5xl bg-white/90 backdrop-blur rounded-2xl shadow-xl ring-1 ring-gray-200">
        <div class="p-6 border-b border-gray-100 flex items-center justify-between">
            <h1 class="text-xl font-semibold text-gray-900">Đơn hàng #@Model.OrderID</h1>
            <a href="@Url.Action("OrderAdminHome")" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50">Trở lại</a>
        </div>
        <div class="h-1 bg-gradient-to-r @accentFrom via-transparent @accentTo opacity-30"></div>

        <div class="p-6 space-y-6">
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="rounded-md bg-emerald-50 p-3 text-emerald-800 text-sm">@TempData["SuccessMessage"]</div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="rounded-md bg-rose-50 p-3 text-rose-800 text-sm">@TempData["ErrorMessage"]</div>
            }

            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div class="rounded-xl border border-gray-100 border-l-4 @borderAccent bg-white">
                    <div class="px-5 py-3 border-b border-gray-100 text-sm font-semibold text-gray-800">Thông tin đơn hàng</div>
                    <div class="p-5 text-sm text-gray-800">
                        <dl class="space-y-3">
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">Mã đơn hàng</dt>
                                <dd class="font-medium text-gray-900">#@Model.OrderID</dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">Ngày đặt</dt>
                                <dd class="font-medium text-gray-900">@Model.OrderTime.ToString("dd/MM/yyyy HH:mm")</dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">Trạng thái</dt>
                                <dd>
                                    @switch (Model.OrderStatus)
                                    {
                                        case ComputerSales.Domain.Entity.E_Order.OrderStatus.ChoXacNhan:
                                            <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800">Chờ xác nhận</span>
                                            break;
                                        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DangDongGoi:
                                            <span class="inline-flex items-center rounded-full bg-sky-100 px-2.5 py-0.5 text-xs font-medium text-sky-800">Đang đóng gói</span>
                                            break;
                                        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DangGiao:
                                            <span class="inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800">Đang giao</span>
                                            break;
                                        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DaGiaoThanhCong:
                                            <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-medium text-emerald-800">Đã giao thành công</span>
                                            break;
                                        case ComputerSales.Domain.Entity.E_Order.OrderStatus.DaHuy:
                                            <span class="inline-flex items-center rounded-full bg-rose-100 px-2.5 py-0.5 text-xs font-medium text-rose-800">Đã hủy</span>
                                            break;
                                    }
                                </dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">Tổng tiền</dt>
                                <dd class="text-base font-bold text-emerald-600">@Model.GrandTotal.ToString("N0") VNĐ</dd>
                            </div>
                            <div class="flex items-start justify-between">
                                <dt class="text-gray-500">Ghi chú</dt>
                                <dd class="max-w-[70%] text-gray-700">@(Model.OrderNote ?? "Không có")</dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <div class="rounded-xl border border-gray-100 bg-white">
                    <div class="px-5 py-3 border-b border-gray-100 text-sm font-semibold text-gray-800">Thông tin khách hàng</div>
                    <div class="p-5 text-sm text-gray-800">
                        <dl class="space-y-3">
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">ID Khách hàng</dt>
                                <dd class="font-medium text-gray-900">@Model.IDCustomer</dd>
                            </div>
                            <div class="flex items-center justify-between">
                                <dt class="text-gray-500">Phương thức thanh toán</dt>
                                <dd class="font-medium text-gray-900">@(Model.PaymentID?.ToString() ?? "Chưa chọn")</dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>

            <div class="pt-4 flex items-center justify-end gap-2">
                <a href="@Url.Action("OrderAdminHome")" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50">Quay lại</a>
                @if (Model.OrderStatus != ComputerSales.Domain.Entity.E_Order.OrderStatus.DangGiao && 
                     Model.OrderStatus != ComputerSales.Domain.Entity.E_Order.OrderStatus.DaGiaoThanhCong &&
                     Model.OrderStatus != ComputerSales.Domain.Entity.E_Order.OrderStatus.DaHuy)
                {
                    <button type="button" onclick="cancelOrderDetail(@Model.OrderID)"
                            class="inline-flex items-center rounded-md bg-rose-600 px-3 py-1.5 text-sm font-medium text-white shadow hover:bg-rose-700">Hủy đơn</button>
                }
                else if (Model.OrderStatus == ComputerSales.Domain.Entity.E_Order.OrderStatus.DaHuy)
                {
                    <span class="text-sm text-gray-500">Đơn hàng đã được hủy</span>
                }
                else
                {
                    <span class="text-sm text-gray-500">Không thể hủy đơn hàng đang giao hoặc đã giao</span>
                }
            </div>
        </div>
    </div>
</div>

<script>
    function cancelOrderDetail(orderId) {
        const reason = prompt('Nhập lý do hủy (tuỳ chọn):', '');
        if (!confirm('Xác nhận hủy đơn #' + orderId + '?')) return;

        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '@Url.Action("CancelOrder")';

        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'orderId';
        idInput.value = orderId;

        const reasonInput = document.createElement('input');
        reasonInput.type = 'hidden';
        reasonInput.name = 'cancelReason';
        reasonInput.value = reason || '';

        form.appendChild(idInput);
        form.appendChild(reasonInput);
        document.body.appendChild(form);
        form.submit();
    }
</script>
